# Solution3-1 - 讨论与待办事项

> 基于 solution3 的增强版本

---

## 📋 项目信息

**基础版本:** solution3 (v3.0.0)
**创建日期:** 2025-11-18
**状态:** 开发中

---

## 💡 功能讨论

### 待定功能

目前实现的功能，已经收集好了数据。类似 "依托考昔一盒，2027年3月。" 和“阿莫西林一盒2027年6月。”

问题是，如果要实现结构化清理，比如按照药名，商品名，学术名，数量，规格，包装数量，有效期 来，这样将来方便进行统计，查询 筛选等等； 就需要对目前的输入进行整理。

人工做当然可以，不过费时费力容易错。

这里我想把将来的步骤分两步：

第一步是，用大语言模型 来做分解，比如“阿莫西林一盒2027年6月。”就可以按照字段填入，当然有些没提供的可以空着，有些是可以确定的（即使输入里没有，比如知道药名了，学术名肯定是确定的）

第二步是，把这些结构化好的数据，进行展示，提供统计，查询筛选排序等等。


以上两步，可否在目前的基础上，放到gradio的另外的tab里。

---

## ✅ 待办事项

### 阶段一：数据模型与LLM集成

- [ ] 1.1 创建结构化数据模型 (StructuredMedicine)
- [ ] 1.2 添加LLM配置到config.py
- [ ] 1.3 实现LLM客户端封装 (支持Claude API)
- [ ] 1.4 实现文本结构化服务 (text_parser.py)
- [ ] 1.5 编写结构化解析的单元测试

### 阶段二：UI界面开发

- [ ] 2.1 重构ui.py支持多Tab布局
  - Tab 1: 语音收集（现有功能）
  - Tab 2: 智能结构化
  - Tab 3: 数据分析
- [ ] 2.2 实现Tab 2: 智能结构化界面
  - 原始文本列表
  - 一键结构化按钮
  - 结构化结果表格（可编辑）
  - 保存结构化数据
- [ ] 2.3 实现Tab 3: 数据分析界面
  - 结构化数据展示
  - 筛选功能（按药名、有效期等）
  - 排序功能
  - 统计图表（可选）

### 阶段三：数据存储与管理

- [ ] 3.1 扩展storage.py支持结构化数据
- [ ] 3.2 实现数据导入导出功能
- [ ] 3.3 添加数据备份机制

### 阶段四：优化与完善

- [ ] 4.1 添加批量处理功能
- [ ] 4.2 优化LLM提示词（提高准确度）
- [ ] 4.3 添加手动修正功能
- [ ] 4.4 完善错误处理和日志
- [ ] 4.5 更新文档

---

## 🤔 技术决策

### 已决策的问题

1. **LLM选择**
   - 描述：使用哪种大语言模型进行文本结构化
   - 可能方案：
     - OpenAI GPT (需要API key)
     - Anthropic Claude (需要API key)
     - 本地LLM (如Ollama)
   - **决策：可配置方式，优先实现Claude API** ✅
   - 原因：用户已有Claude API key，后续可扩展支持其他LLM

2. **数据模型设计**
   - 描述：结构化数据的字段设计
   - **决策：**
     ```python
     StructuredMedicine:
       - id: int
       - original_text: str        # 原始文本
       - drug_name: str           # 药名（通用名）
       - brand_name: str          # 商品名
       - generic_name: str        # 学术名/化学名
       - quantity: float          # 数量
       - unit: str               # 单位
       - specification: str       # 规格
       - package_count: str       # 包装数量
       - expiry_date: str        # 有效期
       - timestamp: str          # 录入时间
     ```

3. **UI布局设计**
   - 描述：如何组织多个功能模块
   - **决策：使用Gradio的Tab组件** ✅
     - Tab 1: 语音收集（保留现有功能）
     - Tab 2: 智能结构化（新增）
     - Tab 3: 数据分析（新增）

### 待讨论的问题

1. **药品知识库**
   - 描述：是否需要维护一个药品知识库来辅助LLM
   - 可能方案：
     - A: 纯LLM推断
     - B: 本地药品数据库 + LLM
     - C: 调用外部药品API
   - 决策：待定

2. **数据校验**
   - 描述：如何验证LLM提取的数据准确性
   - 可能方案：
     - A: 人工审核
     - B: 规则验证 + 人工确认
     - C: 双LLM交叉验证
   - 决策：待定

---

## 📝 开发笔记

### 2025-11-18

- 从 solution3 完整拷贝代码
- 创建 discussion&todo.md

---

## 🔍 需要改进的地方

（记录当前版本中发现的问题或可以优化的地方）

---

## 🎯 未来规划

（长期功能规划）

---

## 📚 参考资料

- [solution3 README](../solution3/README.md)
- [solution3 DEVELOPMENT](../solution3/DEVELOPMENT.md)
