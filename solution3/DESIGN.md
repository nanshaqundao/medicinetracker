# è¯å“ä¿¡æ¯æ”¶é›†å™¨ - è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡
å¼€å‘ä¸€ä¸ªåŸºäºGradioçš„Webåº”ç”¨ï¼Œæ”¯æŒé€šè¿‡è¯­éŸ³å’Œæ‰‹åŠ¨è¾“å…¥æ”¶é›†è¯å“ä¿¡æ¯ï¼Œå¹¶è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨å’Œç®¡ç†ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½
- ğŸ¤ **è¯­éŸ³è¾“å…¥**: å•æ¬¡æ¨¡å¼å’Œè¿ç»­æ¨¡å¼
- âœï¸ **æ‰‹åŠ¨è¾“å…¥**: æ–‡æœ¬æ¡†è¾“å…¥
- ğŸ“Š **æ•°æ®å±•ç¤º**: å¯è¯»è¡¨æ ¼æ˜¾ç¤ºï¼ˆæœ€æ–°åœ¨ä¸Šï¼‰
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**: JSONæ–‡ä»¶å­˜å‚¨
- ğŸ“¥ **æ•°æ®å¯¼å‡º**: å¯¼å‡ºä¸ºTXTæ–‡ä»¶
- ğŸ—‘ï¸ **æ•°æ®ç®¡ç†**: æ¸…ç©ºæ‰€æœ‰æ•°æ®

### 1.3 æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Gradio 5.49.1
- **è¯­éŸ³è¯†åˆ«**: Web Speech API (æµè§ˆå™¨åŸç”Ÿ)
- **åç«¯è¯­è¨€**: Python 3.10+
- **æ•°æ®å­˜å‚¨**: JSONæ–‡ä»¶
- **æµ‹è¯•æ¡†æ¶**: pytest

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer          â”‚
â”‚         (Gradio UI)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Business Logic Layer        â”‚
â”‚    (Entry Management, Validation)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Data Access Layer           â”‚
â”‚      (JSON File Storage)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Data Model Layer            â”‚
â”‚      (Entry, EntryList)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åˆ’åˆ†

```
src/
â”œâ”€â”€ models.py       # æ•°æ®æ¨¡å‹ (Entry, EntryList)
â”œâ”€â”€ storage.py      # å­˜å‚¨å±‚ (JSONStorage)
â”œâ”€â”€ service.py      # ä¸šåŠ¡é€»è¾‘ (EntryService)
â”œâ”€â”€ ui.py          # UIç»„ä»¶ (GradioUI)
â””â”€â”€ voice.py       # è¯­éŸ³è¯†åˆ« (JavaScriptä»£ç )
```

---

## 3. æ•°æ®æ¨¡å‹

### 3.1 Entry (æ¡ç›®)

```python
@dataclass
class Entry:
    id: int                  # å”¯ä¸€æ ‡è¯† (æ¯«ç§’æ—¶é—´æˆ³)
    text: str               # è¯å“ä¿¡æ¯æ–‡æœ¬
    timestamp: str          # å½•å…¥æ—¶é—´ "YYYY-MM-DD HH:MM:SS"

    def to_dict(self) -> dict
    @classmethod
    def from_dict(cls, data: dict) -> Entry
    def to_dataframe_row(self, number: int) -> list
```

### 3.2 EntryList (æ¡ç›®åˆ—è¡¨)

```python
class EntryList:
    entries: List[Entry]

    def add(self, text: str) -> Entry
    def get_all(self) -> List[Entry]
    def get_reversed(self) -> List[Entry]
    def clear(self) -> None
    def to_dict_list(self) -> List[dict]
    def to_dataframe(self) -> List[list]
    @classmethod
    def from_dict_list(cls, data: List[dict]) -> EntryList
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 4.1 è¯­éŸ³è¾“å…¥

#### 4.1.1 å•æ¬¡æ¨¡å¼
1. ç”¨æˆ·ç‚¹å‡»"ğŸ¤ å•æ¬¡è¯­éŸ³è¾“å…¥"
2. æµè§ˆå™¨è¯·æ±‚éº¦å…‹é£æƒé™
3. Web Speech APIå¼€å§‹è¯†åˆ«
4. è¯†åˆ«ç»“æœå¡«å……åˆ°æ–‡æœ¬æ¡†
5. ç”¨æˆ·ç‚¹å‡»"æ·»åŠ åˆ°åˆ—è¡¨"

#### 4.1.2 è¿ç»­æ¨¡å¼ (æ¨è)
1. ç”¨æˆ·ç‚¹å‡»"ğŸ”´ è¿ç»­è¯­éŸ³è¾“å…¥"
2. æµè§ˆå™¨è¯·æ±‚éº¦å…‹é£æƒé™
3. è¯†åˆ«ç»“æœè‡ªåŠ¨æ·»åŠ åˆ°åˆ—è¡¨
4. è¯†åˆ«ç»“æŸåè‡ªåŠ¨é‡å¯ï¼ŒæŒç»­å¾ªç¯
5. å†æ¬¡ç‚¹å‡»æŒ‰é’®åœæ­¢

#### 4.1.3 æŠ€æœ¯å®ç°
- ä½¿ç”¨Web Speech API (`webkitSpeechRecognition`)
- è¯­è¨€è®¾ç½®: `zh-CN` (ä¸­æ–‡)
- è¿ç»­æ¨¡å¼é€šè¿‡`onend`äº‹ä»¶å¾ªç¯é‡å¯
- ä½¿ç”¨çŠ¶æ€æ ‡å¿—é˜²æ­¢é‡å¤å¯åŠ¨

### 4.2 æ•°æ®ç®¡ç†

#### 4.2.1 æ·»åŠ æµç¨‹
```
è¾“å…¥æ–‡æœ¬ â†’ éªŒè¯éç©º â†’ åˆ›å»ºEntry â†’ ä¿å­˜åˆ°Storage â†’ æ›´æ–°UI
```

#### 4.2.2 å­˜å‚¨æ ¼å¼
```json
[
  {
    "id": 1763412159088,
    "text": "é˜¿è«è¥¿æ—ä¸€ç›’2027å¹´3æœˆã€‚",
    "timestamp": "2025-11-17 20:42:39"
  }
]
```

#### 4.2.3 æ˜¾ç¤ºæ ¼å¼
- Gradio Dataframeç»„ä»¶
- åˆ—: [åºå·, è¯å“ä¿¡æ¯, å½•å…¥æ—¶é—´, ID]
- æ’åº: æœ€æ–°çš„åœ¨æœ€ä¸Šé¢ (å€’åº)
- åªè¯»æ¨¡å¼ (é˜²æ­¢è¯¯æ“ä½œ)

### 4.3 æ•°æ®å¯¼å‡º

#### 4.3.1 å¯¼å‡ºæ ¼å¼ (TXT)
```
1. é˜¿è«è¥¿æ—ä¸€ç›’2027å¹´3æœˆã€‚
2. ä¾æ‰˜è€ƒæ˜”ä¸€ç›’ï¼Œ2027å¹´6æœˆã€‚
3. ç§‹æ°´ä»™ç¢±ä¸€ç›’2028å¹´3æœˆã€‚
```

#### 4.3.2 æ–‡ä»¶å
```
medicine_list_YYYYMMDD_HHMMSS.txt
```

---

## 5. å®‰å…¨æ€§è®¾è®¡

### 5.1 æ•°æ®å®Œæ•´æ€§
- âœ… æ‰€æœ‰å†™æ“ä½œç«‹å³æŒä¹…åŒ–
- âœ… ç§»é™¤å±é™©çš„"ä¿å­˜ä¿®æ”¹"æŒ‰é’®
- âœ… Dataframeè®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢è¯¯æ“ä½œè¦†ç›–
- âœ… æ¸…ç©ºæ“ä½œä½¿ç”¨é†’ç›®çš„"stop"æ ·å¼æé†’

### 5.2 è¾“å…¥éªŒè¯
- ç©ºå­—ç¬¦ä¸²æ£€æŸ¥
- æ–‡æœ¬å»é™¤é¦–å°¾ç©ºæ ¼
- IDå”¯ä¸€æ€§ä¿è¯ (æ¯«ç§’æ—¶é—´æˆ³)

### 5.3 é”™è¯¯å¤„ç†
- æ–‡ä»¶è¯»å–å¤±è´¥ â†’ è¿”å›ç©ºåˆ—è¡¨
- JSONè§£æå¤±è´¥ â†’ è¿”å›ç©ºåˆ—è¡¨
- è¯­éŸ³è¯†åˆ«å¤±è´¥ â†’ æç¤ºç”¨æˆ·

---

## 6. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 6.1 å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ‡é¢˜: è¯å“ä¿¡æ¯æ”¶é›†å™¨                  â”‚
â”‚  ç»Ÿè®¡: å·²æ”¶é›† X æ¡                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯­éŸ³è¾“å…¥åŒºåŸŸ                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚å•æ¬¡è¯­éŸ³  â”‚  â”‚è¿ç»­è¯­éŸ³(æ¨è) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  [æ–‡æœ¬æ¡†: è¯†åˆ«ç»“æœ/æ‰‹åŠ¨è¾“å…¥]          â”‚
â”‚  [â• æ·»åŠ åˆ°åˆ—è¡¨]                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ”¶é›†åˆ—è¡¨ (Dataframe)                 â”‚
â”‚  # | è¯å“ä¿¡æ¯ | å½•å…¥æ—¶é—´ | ID         â”‚
â”‚  3 | xxx     | xxx     | xxx        â”‚
â”‚  2 | xxx     | xxx     | xxx        â”‚
â”‚  1 | xxx     | xxx     | xxx        â”‚
â”‚                                      â”‚
â”‚  [ğŸ”„åˆ·æ–°] [ğŸ“¥å¯¼å‡º] [ğŸ—‘ï¸æ¸…ç©º]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä½¿ç”¨è¯´æ˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 äº¤äº’æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æ‰“å¼€é¡µé¢] --> B{é€‰æ‹©è¾“å…¥æ–¹å¼}
    B -->|è¯­éŸ³| C[ç‚¹å‡»è¯­éŸ³æŒ‰é’®]
    B -->|æ‰‹åŠ¨| D[æ–‡æœ¬æ¡†è¾“å…¥]
    C --> E[è¯­éŸ³è¯†åˆ«]
    E --> F[è‡ªåŠ¨/æ‰‹åŠ¨æ·»åŠ ]
    D --> F
    F --> G[ä¿å­˜åˆ°JSON]
    G --> H[æ›´æ–°æ˜¾ç¤º]
    H --> I{ç»§ç»­æ“ä½œ?}
    I -->|æ˜¯| B
    I -->|å¦| J[å¯¼å‡º/æ¸…ç©º]
```

---

## 7. æµ‹è¯•ç­–ç•¥

### 7.1 å•å…ƒæµ‹è¯•

#### 7.1.1 models.py
- `test_entry_creation`: åˆ›å»ºEntryå¯¹è±¡
- `test_entry_to_dict`: Entryåºåˆ—åŒ–
- `test_entry_from_dict`: Entryååºåˆ—åŒ–
- `test_entrylist_add`: æ·»åŠ æ¡ç›®
- `test_entrylist_to_dataframe`: è½¬æ¢ä¸ºDataframeæ ¼å¼

#### 7.1.2 storage.py
- `test_save_and_load`: ä¿å­˜å’ŒåŠ è½½
- `test_load_empty_file`: åŠ è½½ç©ºæ–‡ä»¶
- `test_load_nonexistent_file`: åŠ è½½ä¸å­˜åœ¨çš„æ–‡ä»¶
- `test_save_empty_list`: ä¿å­˜ç©ºåˆ—è¡¨

#### 7.1.3 service.py
- `test_add_entry`: æ·»åŠ æ¡ç›®
- `test_add_empty_entry`: æ·»åŠ ç©ºæ¡ç›®
- `test_clear_all`: æ¸…ç©ºæ‰€æœ‰
- `test_export_text`: å¯¼å‡ºæ–‡æœ¬

### 7.2 é›†æˆæµ‹è¯•
- `test_end_to_end_workflow`: å®Œæ•´æµç¨‹æµ‹è¯•
- `test_data_persistence`: æ•°æ®æŒä¹…åŒ–æµ‹è¯•

### 7.3 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
- ä»£ç è¦†ç›–ç‡: > 85%
- æ ¸å¿ƒåŠŸèƒ½è¦†ç›–ç‡: 100%

---

## 8. éƒ¨ç½²å’Œè¿è¡Œ

### 8.1 ç¯å¢ƒè¦æ±‚
- Python 3.10+
- æµè§ˆå™¨: Chrome / Edge (æ”¯æŒWeb Speech API)

### 8.2 å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 8.3 è¿è¡Œåº”ç”¨
```bash
python app.py
```

### 8.4 è¿è¡Œæµ‹è¯•
```bash
pytest tests/ -v --cov=src
```

---

## 9. æœªæ¥æ‰©å±•

### 9.1 çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ è¯å“åˆ†ç±»åŠŸèƒ½
- [ ] æ·»åŠ è¿‡æœŸæ—¥æœŸæé†’
- [ ] æ”¯æŒç¼–è¾‘å•æ¡è®°å½•
- [ ] æ·»åŠ æœç´¢åŠŸèƒ½

### 9.2 é•¿æœŸè®¡åˆ’
- [ ] å¤šç”¨æˆ·æ”¯æŒ
- [ ] æ•°æ®åº“å­˜å‚¨ (SQLite/PostgreSQL)
- [ ] OCRè¯†åˆ«è¯ç›’
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] äº‘ç«¯åŒæ­¥

---

## 10. ç‰ˆæœ¬å†å²

### v3.0 (2025-11-17)
- âœ… ä½¿ç”¨Gradio DataframeåŸç”Ÿç»„ä»¶
- âœ… ç§»é™¤å±é™©çš„"ä¿å­˜ä¿®æ”¹"æŒ‰é’®
- âœ… Dataframeæ”¹ä¸ºåªè¯»æ¨¡å¼
- âœ… æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•
- âœ… è§„èŒƒåŒ–é¡¹ç›®ç»“æ„

### v2.0 (2025-11-16)
- æ·»åŠ è¿ç»­è¯­éŸ³æ¨¡å¼
- ä¿®å¤è¯­éŸ³è¯†åˆ«å¾ªç¯bug
- æ”¹è¿›UIå¸ƒå±€

### v1.0 (2025-11-16)
- åˆå§‹ç‰ˆæœ¬
- å•æ¬¡è¯­éŸ³è¾“å…¥
- JSONå­˜å‚¨

---

## é™„å½•

### A. æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯­éŸ³è¯†åˆ«  â”‚â”€â”€â”€â”€>â”‚  æ·»åŠ æ¡ç›® â”‚â”€â”€â”€â”€>â”‚  ä¿å­˜JSON â”‚â”€â”€â”€â”€>â”‚  æ›´æ–°UI   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–²
                      â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ æ‰‹åŠ¨è¾“å…¥  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### B. ç›®å½•ç»“æ„

```
solution3/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ storage.py         # å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ service.py         # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ ui.py             # UIç»„ä»¶
â”‚   â””â”€â”€ voice.py          # è¯­éŸ³JSä»£ç 
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_models.py
â”‚   â”œâ”€â”€ test_storage.py
â”‚   â””â”€â”€ test_service.py
â”œâ”€â”€ data/
â”‚   â””â”€â”€ voice_entries.json # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ app.py                # ä¸»å…¥å£
â”œâ”€â”€ config.py             # é…ç½®
â”œâ”€â”€ requirements.txt      # ä¾èµ–
â”œâ”€â”€ DESIGN.md            # æœ¬æ–‡æ¡£
â””â”€â”€ README.md            # ä½¿ç”¨è¯´æ˜
```
